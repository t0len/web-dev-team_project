@if (book) {
    <div class="book-detail-container">
      <mat-card class="book-card">
        <div class="book-header">
          <img [src]="book.coverImage" alt="Cover of {{book.title}}">
          <div class="book-info">
            <h1>{{ book.title }}</h1>
            <h2>by {{ book.author }}</h2>
            <p>{{ book.description }}</p>
            <div class="actions">
              <button mat-raised-button color="primary" (click)="downloadBook()">
                Download
              </button>
              @if (authService.isAuthenticated()) {
                <button mat-button routerLink="/add-book" [queryParams]="{edit: book.id}">
                  Edit
                </button>
              }
            </div>
          </div>
        </div>
      </mat-card>
  
      <mat-divider></mat-divider>
  
      <div class="reviews-section">
        <h3>Reviews</h3>
        
        @if (authService.isAuthenticated()) {
          <div class="add-review">
            <textarea [(ngModel)]="newReview.comment" placeholder="Your review"></textarea>
            <mat-slider min="1" max="5" step="1" [(ngModel)]="newReview.rating">
              <input matSliderThumb>
            </mat-slider>
            <button mat-raised-button color="primary" (click)="addReview()">Submit Review</button>
          </div>
        }
  
        @for (review of reviews; track review.id) {
          <div class="review-card">
            <div class="review-header">
              <span class="user">{{ review.user.name }}</span>
              <div class="rating">
                @for (star of [1,2,3,4,5]; track star) {
                  <mat-icon>{{ star <= review.rating ? 'star' : 'star_border' }}</mat-icon>
                }
              </div>
            </div>
            <p class="comment">{{ review.comment }}</p>
            <span class="date">{{ review.created_at | date }}</span>
          </div>
        }
      </div>
    </div>
  } @else {
    <mat-spinner class="loading-spinner"></mat-spinner>
  }
